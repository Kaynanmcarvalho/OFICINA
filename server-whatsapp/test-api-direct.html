<!DOCTYPE html>
<html>
<head>
    <title>Teste API WhatsApp</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        #qrcode {
            margin-top: 20px;
        }
        img {
            max-width: 300px;
        }
    </style>
</head>
<body>
    <h1>Teste API WhatsApp</h1>
    
    <div>
        <label>EmpresaId:</label>
        <input type="text" id="empresaId" value="super-admin-renier" style="width: 300px; padding: 5px;">
    </div>
    
    <div>
        <button onclick="testStatus()">1. Verificar Status</button>
        <button onclick="testConnect()">2. Conectar</button>
        <button onclick="testDisconnect()">3. Desconectar</button>
    </div>
    
    <div id="result"></div>
    <div id="qrcode"></div>
    
    <script>
        const API_URL = 'http://localhost:5000';
        
        function getEmpresaId() {
            return document.getElementById('empresaId').value;
        }
        
        function showResult(title, data) {
            document.getElementById('result').textContent = 
                `${title}\n\n${JSON.stringify(data, null, 2)}`;
        }
        
        async function testStatus() {
            try {
                const empresaId = getEmpresaId();
                console.log('Testando status para:', empresaId);
                
                const response = await fetch(`${API_URL}/api/whatsapp/status?empresaId=${empresaId}`);
                const data = await response.json();
                
                showResult('✅ Status:', data);
            } catch (error) {
                showResult('❌ Erro:', { error: error.message });
            }
        }
        
        async function testConnect() {
            try {
                const empresaId = getEmpresaId();
                console.log('Testando conexão para:', empresaId);
                
                const response = await fetch(`${API_URL}/api/whatsapp/connect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ empresaId })
                });
                
                const data = await response.json();
                
                showResult('✅ Conexão:', data);
                
                // Mostrar QR Code se disponível
                if (data.qr) {
                    document.getElementById('qrcode').innerHTML = 
                        `<h3>QR Code:</h3><img src="${data.qr}" alt="QR Code">`;
                } else {
                    document.getElementById('qrcode').innerHTML = '';
                }
            } catch (error) {
                showResult('❌ Erro:', { error: error.message });
            }
        }
        
        async function testDisconnect() {
            try {
                const empresaId = getEmpresaId();
                console.log('Testando desconexão para:', empresaId);
                
                const response = await fetch(`${API_URL}/api/whatsapp/disconnect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ empresaId })
                });
                
                const data = await response.json();
                
                showResult('✅ Desconexão:', data);
                document.getElementById('qrcode').innerHTML = '';
            } catch (error) {
                showResult('❌ Erro:', { error: error.message });
            }
        }
    </script>
</body>
</html>
