# ğŸ“Š Diagrama de Fluxo - EmissÃ£o de NFS-e

## ğŸ¯ Fluxo Completo (Passo a Passo)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUÃRIO NO SISTEMA                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. CAIXA - Adiciona produtos/serviÃ§os ao carrinho                  â”‚
â”‚     - Produto 1: Consultoria TI - R$ 500,00                         â”‚
â”‚     - Produto 2: Suporte tÃ©cnico - R$ 500,00                        â”‚
â”‚     Total: R$ 1.000,00                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. PAYMENT MODAL - Configura pagamento                             â”‚
â”‚     - MÃ©todo: PIX                                                   â”‚
â”‚     - Valor: R$ 1.000,00                                            â”‚
â”‚     - Desconto: R$ 0,00                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. SALE CONFIRMATION MODAL - Confirma venda                        â”‚
â”‚     â˜‘ Gerar Nota Fiscal EletrÃ´nica                                 â”‚
â”‚     â—‰ NFS-e (ServiÃ§o)  â† SELECIONADO                               â”‚
â”‚                                                                     â”‚
â”‚     Dados do Cliente (obrigatÃ³rio):                                 â”‚
â”‚     - Nome: BRC Comercio e Servicos Ltda                            â”‚
â”‚     - CNPJ: 58.959.068/0001-82                                      â”‚
â”‚     - Email: contato@cliente.com.br                                 â”‚
â”‚     - EndereÃ§o completo                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. REACT - Caixa.jsx                                               â”‚
â”‚     handleSaleConfirm(confirmationData)                             â”‚
â”‚                                                                     â”‚
â”‚     const saleData = {                                              â”‚
â”‚       items: cartItems,                                             â”‚
â”‚       total: 1000.00,                                               â”‚
â”‚       customer: customerData,                                       â”‚
â”‚       nfeType: 'nfse'  â† IMPORTANTE                                â”‚
â”‚     }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. FIRESTORE - Salva venda                                         â”‚
â”‚     Collection: 'vendas'                                            â”‚
â”‚     {                                                               â”‚
â”‚       items: [...],                                                 â”‚
â”‚       total: 1000.00,                                               â”‚
â”‚       timestamp: "2024-01-15T10:30:00Z",                            â”‚
â”‚       nfId: null  â† SerÃ¡ preenchido depois                         â”‚
â”‚     }                                                               â”‚
â”‚     â†’ vendaDoc.id = "venda_abc123"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. REACT - nfseService.js                                          â”‚
â”‚     prepareDadosNFSe(saleData, config, customer)                    â”‚
â”‚                                                                     â”‚
â”‚     Calcula:                                                        â”‚
â”‚     - vServicos = R$ 1.000,00                                       â”‚
â”‚     - vISS (5%) = R$ 50,00                                          â”‚
â”‚     - vLiquido = R$ 950,00                                          â”‚
â”‚                                                                     â”‚
â”‚     Monta JSON completo da NFS-e                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. REACT - Envia POST para Backend                                 â”‚
â”‚     URL: http://localhost:8000/nuvem-fiscal                         â”‚
â”‚     Method: POST                                                    â”‚
â”‚     Headers: { 'Content-Type': 'application/json' }                â”‚
â”‚                                                                     â”‚
â”‚     Body: {                                                         â”‚
â”‚       "action": "emitir_nfse",                                      â”‚
â”‚       "clientId": "Qn0V1xTQWXdvk2zCVJkL",                          â”‚
â”‚       "clientSecret": "DE65kY0SZas4j840MlJSAjZ4yRx9fmFH2tnBU9dI",  â”‚
â”‚       "ambiente": "homologacao",                                    â”‚
â”‚       "nfseData": {                                                 â”‚
â”‚         "provedor": "padrao",                                       â”‚
â”‚         "referencia": "NFSE-1705320600000",                         â”‚
â”‚         "infDPS": {                                                 â”‚
â”‚           "tpAmb": 2,                                               â”‚
â”‚           "dhEmi": "2024-01-15T10:30:00-03:00",                     â”‚
â”‚           "prest": { "CNPJ": "57673794000171", ... },               â”‚
â”‚           "toma": { "CNPJ": "58959068000182", ... },                â”‚
â”‚           "serv": { ... },                                          â”‚
â”‚           "valores": { ... }                                        â”‚
â”‚         }                                                           â”‚
â”‚       }                                                             â”‚
â”‚     }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. BACKEND (Node.js) - Recebe requisiÃ§Ã£o                          â”‚
â”‚     app.post('/nuvem-fiscal', async (req, res) => {                â”‚
â”‚       const { action, clientId, clientSecret, nfseData } = req.bodyâ”‚
â”‚                                                                     â”‚
â”‚       if (action === 'emitir_nfse') {                               â”‚
â”‚         // Processa emissÃ£o                                         â”‚
â”‚       }                                                             â”‚
â”‚     })                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9. BACKEND â†’ NUVEM FISCAL API                                      â”‚
â”‚     POST https://api.nuvemfiscal.com.br/nfse                        â”‚
â”‚     Headers: {                                                      â”‚
â”‚       'Authorization': 'Bearer {token}',                            â”‚
â”‚       'Content-Type': 'application/json'                            â”‚
â”‚     }                                                               â”‚
â”‚     Body: nfseData (JSON preparado pelo React)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  10. NUVEM FISCAL API - Processa NFS-e                             â”‚
â”‚      - Valida dados                                                 â”‚
â”‚      - Calcula impostos                                             â”‚
â”‚      - Gera XML                                                     â”‚
â”‚      - Envia para SEFAZ                                             â”‚
â”‚      - Aguarda autorizaÃ§Ã£o                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  11. NUVEM FISCAL API â†’ BACKEND                                     â”‚
â”‚      Response: {                                                    â”‚
â”‚        "id": "dps_abc123xyz789",                                    â”‚
â”‚        "numero": "123",                                             â”‚
â”‚        "serie": "1",                                                â”‚
â”‚        "chave_acesso": "35240157673794000171990010000001231...",    â”‚
â”‚        "status": "autorizado",                                      â”‚
â”‚        "protocolo": "135240000123456",                              â”‚
â”‚        "data_emissao": "2024-01-15T10:30:00-03:00"                  â”‚
â”‚      }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  12. BACKEND â†’ REACT                                                â”‚
â”‚      Response: {                                                    â”‚
â”‚        "success": true,                                             â”‚
â”‚        "data": {                                                    â”‚
â”‚          "id": "dps_abc123xyz789",                                  â”‚
â”‚          "numero": "123",                                           â”‚
â”‚          "chave_acesso": "35240157673794000171990010000001231...",  â”‚
â”‚          "status": "autorizado",                                    â”‚
â”‚          ...                                                        â”‚
â”‚        }                                                            â”‚
â”‚      }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  13. REACT - Processa resposta                                      â”‚
â”‚      if (result.success) {                                          â”‚
â”‚        // Salvar NFS-e no Firestore                                 â”‚
â”‚        await addDoc(collection(db, 'nfses'), {                      â”‚
â”‚          numero: result.data.numero,                                â”‚
â”‚          chave: result.data.chave_acesso,                           â”‚
â”‚          status: result.data.status,                                â”‚
â”‚          vendaId: vendaDoc.id,                                      â”‚
â”‚          nuvemFiscalId: result.data.id                              â”‚
â”‚        })                                                           â”‚
â”‚      }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  14. FIRESTORE - Salva NFS-e                                        â”‚
â”‚      Collection: 'nfses'                                            â”‚
â”‚      {                                                              â”‚
â”‚        numero: "123",                                               â”‚
â”‚        chave: "35240157673794000171990010000001231234567890",       â”‚
â”‚        status: "autorizado",                                        â”‚
â”‚        protocolo: "135240000123456",                                â”‚
â”‚        vendaId: "venda_abc123",                                     â”‚
â”‚        nuvemFiscalId: "dps_abc123xyz789",                           â”‚
â”‚        timestamp: "2024-01-15T10:30:00Z"                            â”‚
â”‚      }                                                              â”‚
â”‚      â†’ nfseDoc.id = "nfse_xyz789"                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  15. FIRESTORE - Atualiza venda                                     â”‚
â”‚      Collection: 'vendas'                                           â”‚
â”‚      Document: "venda_abc123"                                       â”‚
â”‚      Update: {                                                      â”‚
â”‚        nfId: "nfse_xyz789",                                         â”‚
â”‚        nfNumero: "123",                                             â”‚
â”‚        nfChave: "35240157673794000171990010000001231234567890",     â”‚
â”‚        nfStatus: "autorizado",                                      â”‚
â”‚        nfTipo: "nfse"                                               â”‚
â”‚      }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  16. REACT - Mostra notificaÃ§Ã£o                                     â”‚
â”‚      showNotification('NFS-e emitida com sucesso!', 'success')      â”‚
â”‚                                                                     â”‚
â”‚      Modal exibe:                                                   â”‚
â”‚      âœ… NFS-e emitida com sucesso!                                  â”‚
â”‚      NÃºmero: 123                                                    â”‚
â”‚      SÃ©rie: 1                                                       â”‚
â”‚      Status: autorizado                                             â”‚
â”‚      Chave: 35240157673794000171990010000001231234567890            â”‚
â”‚                                                                     â”‚
â”‚      [Baixar XML] [Baixar PDF] [Fechar]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  17. USUÃRIO - VÃª confirmaÃ§Ã£o                                       â”‚
â”‚      âœ… Venda finalizada                                            â”‚
â”‚      âœ… NFS-e emitida                                               â”‚
â”‚      âœ… Carrinho limpo                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Fluxo de Dados (Simplificado)

```
React Frontend          Backend Node.js         Nuvem Fiscal API
     â”‚                       â”‚                         â”‚
     â”‚  POST /nuvem-fiscal   â”‚                         â”‚
     â”‚  action: emitir_nfse  â”‚                         â”‚
     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                         â”‚
     â”‚                       â”‚  POST /nfse             â”‚
     â”‚                       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚                       â”‚                         â”‚
     â”‚                       â”‚  â† Response (NFS-e)     â”‚
     â”‚                       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚  â† Response (success) â”‚                         â”‚
     â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
     â”‚                       â”‚                         â”‚
     â–¼                       â–¼                         â–¼
  Firestore              (proxy)                  SEFAZ
```

---

## ğŸ“¦ Estrutura do JSON (Resumida)

### Request (React â†’ Backend)
```json
{
  "action": "emitir_nfse",
  "clientId": "xxx",
  "clientSecret": "yyy",
  "ambiente": "homologacao",
  "nfseData": {
    "provedor": "padrao",
    "referencia": "NFSE-123",
    "infDPS": {
      "prest": { /* Prestador */ },
      "toma": { /* Tomador */ },
      "serv": { /* ServiÃ§os */ },
      "valores": { /* Valores e impostos */ }
    }
  }
}
```

### Response (Backend â†’ React)
```json
{
  "success": true,
  "data": {
    "id": "dps_abc123",
    "numero": "123",
    "chave_acesso": "35240...",
    "status": "autorizado",
    "protocolo": "135240..."
  }
}
```

---

## âš¡ Pontos Importantes

### 1. MÃ©todo HTTP
- **Sempre POST** para todas as operaÃ§Ãµes
- Endpoint Ãºnico: `/nuvem-fiscal`
- DiferenciaÃ§Ã£o via campo `action`

### 2. AutenticaÃ§Ã£o
- **NÃ£o usa Bearer Token no header**
- Credenciais no body: `clientId` e `clientSecret`

### 3. Ambiente
- `homologacao` = Testes
- `producao` = EmissÃ£o real

### 4. CÃ¡lculos AutomÃ¡ticos
O React calcula:
- Valor total dos serviÃ§os
- ISS (5% padrÃ£o)
- Valor lÃ­quido

### 5. Dados ObrigatÃ³rios
Para NFS-e:
- Nome do cliente âœ…
- CPF ou CNPJ âœ…
- EndereÃ§o completo âœ…
- CÃ³digo do municÃ­pio (IBGE) âœ…

---

## ğŸ¯ Resumo do Fluxo

1. **UsuÃ¡rio** adiciona serviÃ§os ao carrinho
2. **React** prepara dados da NFS-e
3. **React** envia POST para backend
4. **Backend** repassa para Nuvem Fiscal API
5. **Nuvem Fiscal** processa e autoriza
6. **Backend** retorna resposta
7. **React** salva no Firestore
8. **UsuÃ¡rio** vÃª confirmaÃ§Ã£o

**Tempo total:** ~2-5 segundos
